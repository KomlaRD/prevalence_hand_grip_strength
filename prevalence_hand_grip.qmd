---
title: "Prevalence of hand grip strength among patients with diabetes"
author: "Eric Anku"
format: html
---

```{r load-packages}
pacman::p_load(
  tidyverse,
  googlesheets4,
  janitor,
  skimr,
  gtsummary,
  finalfit
)
```


```{r load-dataset}
# Load dataset
df <- read_sheet("https://docs.google.com/spreadsheets/d/1k_VoEKpsv5EtCjwA7E0oPXegnOe0kpR3X0QN-q-4knM/edit?usp=sharing")
```

```{r clean-names}
# Clean names
df <- clean_names(df)
```

```{r extract-column-names}
# Extract column names starting with data_
data_cols <- names(df)[grepl("^data_", names(df))]

extracted_part <- substr(data_cols, 6, nchar(data_cols))

# Replace existing column names with new extracted names
names(df)[grepl("^data_", names(df))] <- extracted_part
```

```{r remove-redundant-variables}
df <- df%>%
  select(-c(
    meta_instance_id,
    participant_id,
    start_time,
    participant_consent_form,
    end_time
  ))
```

```{r calculate-bmi}
# Calculate body mass index
df <- df%>%
  mutate(
    bmi = weight/(height * height)
  )
```


```{r mutate-additional-variables}
# Low muscle strength cut off EWGSOP2
male_cut_off <- 27
female_cut_off <- 16

df%<%
  mutate(
    bmi_cat = case_when(
      bmi < 18.5 ~ "Underweight",
      bmi >= 18.5 & bmi <= 24.9 ~ "Normal",
      bmi >= 25 & bmi <= 29.9 ~ "Overweight",
      bmi >= 30 ~ "Obese"
    ),
    average_grip_strength = (hand_grip_left + hand_grip_right)/2,
    low_grip_strength = case_when(
      gender == "Male" & average_grip_strength < male_cut_off ~ "Yes",
      gender = "Female" & average_grip_strength < female_cut_off ~ "Yes",
      
    )
  )
```


```{r skim-dataset}
# Skim dataset
skim(df)
```


```{r table-summary}
# Table summary
df%>%
  select(
    -c(if_yes)
  )%>%
  tbl_summary()
```

```{r rename-variables}
# Label variables

```

